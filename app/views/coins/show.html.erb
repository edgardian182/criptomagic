<h1><%= @coin.exchange.name %></h1>
<h3><%= @coin.name %>(<%= @coin.symbol %>)</h3>
<% symbol = @coin.symbol == 'BTC' ? 'BTCUSDT' : @coin.symbol + 'BTC' %>
<%= link_to 'GrÃ¡fico', "http://es.tradingview.com/symbols/#{symbol}", target: '_blank' %>

<!-- FORM -->
<div>
  <%= form_tag(analyze_coin_path, method: :post, class: '') do %>
    <div class="form-row">
      <div class='form-group col-6'>
        <%= label_tag :periods, 'Periodos' %>
        <%= number_field_tag :periods, :quantity, in: 1..24, step: 1, value: params[:analysis] ? params[:analysis][:periods].to_i : 1, class: 'form-control col' %>
      </div>
      <div class='form-group col-6'>
        <%= label_tag :range, 'Rango' %>
        <%= select_tag :range, options_for_select([['15m', '15m'],['30m', '30m'],['1h', '1h']], params[:analysis] ? params[:analysis][:range] : '15m'), class: 'form-control col' %>
      </div>
    </div>
    <div class="form-row">
      <div class='form-group col-6'>
        <%= label_tag :date, 'Fecha' %>
        <%= select_day Time.now, {}, { class: 'form-control col' } %>
        <!-- <%= select_month Time.now %> -->
        <%= select_tag 'date[month]', options_for_select(((Date.today - 1.month).month..Date.today.month).map{|m| [Date::MONTHNAMES[m], m]}, Date.today.month), class: 'form-control col' %>
        <%= select_year Time.now, { start_year: Date.today.month == 1 ? Date.today.year - 1 : Date.today.year, end_year: Date.today.year}, { class: 'form-control col' } %>
      </div>
      <div class='form-group col-6'>
        <%= label_tag :hour, 'Hora' %>
        <%= select_hour Time.now, {}, { class: 'form-control col' } %>
        <%= select_minute Time.now, {}, { class: 'form-control col' } %>
        <!-- <%= datetime_select :date, :time %> -->
      </div>
    </div>

    <%= hidden_field_tag :coin_id, @coin.id.to_s %>
    <%= submit_tag "Analizar", class: 'btn btn-success form-control btn-lg' %>
  <% end %>

  <!-- `ANALYSIS TABLE ` -->
  <% if params['analysis'] %>
    <% analysis = @coin.analyze(params[:analysis][:periods].to_i, params[:analysis][:range], Time.at(params[:analysis][:time].to_i)) %>
    <table class='table table-hover text-center'>
      <thead class='thead-dark'>
        <tr>
          <th>Tiempo</th>
          <th>Alertas</th>
        </tr>
      </thead>
      <tbody>
        <% analysis[@coin.symbol].each do |a| %>
        <tr >
          <td><%= a[0] %></td>
          <td><%= a[1] %></td>
        </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>
</div>
